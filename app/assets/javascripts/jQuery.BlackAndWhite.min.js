
/**
 *
 * Version: 0.2.0
 * Author:  Gianluca Guarini
 * Contact: gianluca.guarini@gmail.com
 * Website: http://www.gianlucaguarini.com/
 * Twitter: @gianlucaguarini
 *
 * Copyright (c) 2011 Gianluca Guarini
 *
 **/
(function(a){a.fn.extend({BlackAndWhite:function(f){function j(a,b,c,d){var g=b.getContext("2d"),b=0;g.drawImage(a,0,0,c,d);var a=g.getImageData(0,0,c,d),d=a.data,f=d.length;if(k&&h)b=new Worker(h+"BnWWorker.js"),b.postMessage(a),b.onmessage=function(a){g.putImageData(a.data,0,0)};else{for(;b<f;b+=4)c=0.3*d[b]+0.59*d[b+1]+0.11*d[b+2],d[b]=d[b+1]=d[b+2]=c;g.putImageData(a,0,0)}}var e=this,f=a.extend({hoverEffect:!0,webworkerPath:!1,responsive:!0},f),i=f.hoverEffect,h=f.webworkerPath,l=f.responsive, m=!!document.createElement("canvas").getContext,n=a(window),k="undefined"!==typeof Worker?!0:!1,o=a.browser.msie&&7===+a.browser.version;this.init=function(){m&&!(a.browser.msie&&"9.0"==a.browser.version)?a(e).each(function(f,b){var c=a(b).find("img");a(c).prop("src");var d=a(c).width(),g=a(c).height();a('<canvas width="'+d+'" height="'+g+'"></canvas>').prependTo(b);var e=a(b).find("canvas");a(e).css({position:"absolute",top:0,left:0});j(c[0],e[0],d,g);i&&(a(this).mouseenter(function(){a(this).find("canvas").stop(!0, !0).fadeOut()}),a(this).mouseleave(function(){a(this).find("canvas").stop(!0,!0).fadeIn()}))}):(a(e).each(function(f,b){var c=a(b).find("img"),d=a(b).find("img").prop("src"),e=a(c).prop("width"),c=a(c).prop("height");a("<img src="+d+' width="'+e+'" height="'+c+'" class="ieFix" /> ').prependTo(b);a(".ieFix").css({position:"absolute",top:0,left:0,filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})}),i&&(a(e).mouseenter(function(){a(this).children(".ieFix").stop(!0,!0).fadeOut()}),a(e).mouseleave(function(){a(this).children(".ieFix").stop(!0, !0).fadeIn()})));if(l)n.on("resize orientationchange",e.resizeImages)};this.resizeImages=function(){a(e).each(function(e,b){var c=a(b).find("img:not(.ieFix)"),d;o?(d=a(c).prop("width"),c=a(c).prop("height")):(d=a(c).width(),c=a(c).height());a(this).find(".ieFix, canvas").css({width:d,height:c})})};return this.init(f)}})})(jQuery);
